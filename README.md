# MS-SQL-find-PSC
Подбор Primary Scrambling Code (PSC) в выделенной области.
Скрипт является упрощением реальной хранимой процедуры, используемой для подбора PSC для СЗФ. 
Выложен в качестве шпаргалки идей: https://github.com/mikhail7311/MS-SQL-find-PSC/blob/main/W_FIND_PSC.sql   
## Суть вычислений: 
1. Расставить 512 чисел по точкам с географическими координатами так, чтобы одинаковые значения отстояли друг от друга на максимально возможном расстоянии. 
2. Для новой точки, подбор числа, удовлетворяющего условию описанному в п.1.
3. Пересчет в некоторой области с учетом существующих чисел вне этой области.
## Реализация:
Инструмент реализован в виде хранимой процедуры (StoredProcedure) на MS SQL Server
(2008-2009)
Интегрирован с MapInfo(MapBASIC): Выбор области для пересчета PSC осуществляется в МапИнфо, после чего все расчеты производятся на MS SQL Server
#### Результат: таблица сот с подобранными PSC.
### Время вычисления на реальных данных: 
на выборке из ~30 тыс сот около 10 мин. 
### Примечания:
Представленный листинг запроса упрощен и не включает:
1. Очистку от засплитованных секторов и обработку indoor секторов
2. Разбиение на сектора. В оригинале азимуты сот группировались по диапазонам, для каждого из которых использовался свой набор PSC - это позволило сократить время расчета и минимизировать ситуацию, когда на сотах направленных друг на друга выставлялись бы одинаковые PSC. В оригинале процедура производила эти вычисления, но можно производить подготовку во вне и подавать на обработку процедуре уже очищенный набор данных.
## Логика расчета:
1. В отмеченной области (списке сот с координатами) выбирается сота, имеющая наименьшее расстояние до сот вне выборки
2. Для соты, выбранной в п.1 вычисляются минимальные расстояния до точек имеющих определенный PSC. Получается таблица с неболее 512 строками в которых указаны уникальные PSC и минимальное расстояние от точки с этим PSC до выбранной соты.
3. Если в таблице из п.2 менее 512 строк, то выбираем PSC, который не присутствует в этой таблице иначе выбираем PSC, имеющий максимальную дистанцию до выбранной соты.
4. Проставляем выбранному сектору значение, выбранное на этапе 3. Исключаем его из выбранной области и возврещаемся к п.1
5. Цикл повторяется до тех пор, пока в отмесенной области не останется ни одного сектора.
